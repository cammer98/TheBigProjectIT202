<!DOCTYPE html>
<html>

<head>
    
<!--     <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> -->
    <link rel='manifest' href='./manifest.json'>
    <link href="https://unpkg.com/material-components-web@1.1.1/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
    <meta name="google-signin-client_id" content="455879692718-31a814ua0ch6tal2errkrtf4976ckq1h.apps.googleusercontent.com">
	<title>3 screen app</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	 crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">

	<style>
		.content {
			display: none;
			margin: 1em;
		}
	</style>
    
    
    <script>
      // Define your database
          //
          var db_name, db_email, db_feedback;
          var db = new Dexie("feedback_database");
          console.log("Database Created");
          db.version(1).stores({
              submission: 'name, email,feedback'
          });
         db.submission.put({name: "Cam", email: "cammer98@gmail.com", feedback: "Good app"}).then (function(){
              //
              // Then when data is stored, read from it
              //
              return db.submission.get('Cam');
          });
          
          
          
          
    </script>

</head>

<body>
    


    <script src="https://unpkg.com/material-components-web@1.1.1/dist/material-components-web.min.js"></script>
    <script src="script.js"></script>
    <script>
        // register the service worker for offline use
        if('serviceWorker' in navigator) {
          navigator.serviceWorker
                   .register('./sw.js')
                   .then(function() { console.log("Service Worker Registered"); });
        }
    </script>
   
<!-- <aside class="mdc-drawer mdc-drawer--dismissible">
    <div class="mdc-drawer__content">
      <nav class="mdc-list">
        <a class="mdc-list-item mdc-list-item--activated" href="#" aria-current="page">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i>
          <span class="mdc-list-item__text">Inbox</span>
        </a>
        <a class="mdc-list-item" href="#">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">send</i>
          <span class="mdc-list-item__text">Outgoing</span>
        </a>
        <a class="mdc-list-item" href="#">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">drafts</i>
          <span class="mdc-list-item__text">Drafts</span>
        </a>
      </nav>
    </div>
  </aside>
  <div class="mdc-drawer-app-content">
    App Content
  </div> -->
    <div class="mdc-tab-bar" role="tablist">
  <div class="mdc-tab-scroller white-box">
    <div class="mdc-tab-scroller__scroll-area">
      <div class="mdc-tab-scroller__scroll-content">
        <button class="mdc-tab mdc-tab--active" href="#home" role="tab" aria-selected="true" tabindex="0">
          <span class="mdc-tab__content">
<!--             <span class="mdc-tab__icon material-icons" aria-hidden="true">favorite</span> -->
            <span class="mdc-tab__text-label">Home</span>
          </span>
          <span class="mdc-tab-indicator mdc-tab-indicator--active">
            <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
          </span>
          <span class="mdc-tab__ripple"></span>
        </button>
           <button class="mdc-tab mdc-tab--active" href="#map_page" role="tab" aria-selected="true" tabindex="1">
          <span class="mdc-tab__content">
<!--             <span class="mdc-tab__icon material-icons" aria-hidden="true">favorite</span> -->
            <span class="mdc-tab__text-label">Havens</span>
          </span>
          <span class="mdc-tab-indicator mdc-tab-indicator--active">
            <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
          </span>
          <span class="mdc-tab__ripple"></span>
        </button>
           <button class="mdc-tab mdc-tab--active" href="#feedback_page" role="tab" aria-selected="true" tabindex="2">
          <span class="mdc-tab__content">
<!--             <span class="mdc-tab__icon material-icons" aria-hidden="true">favorite</span> -->
            <span class="mdc-tab__text-label">Feedback</span>
          </span>
          <span class="mdc-tab-indicator mdc-tab-indicator--active">
            <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
          </span>
          <span class="mdc-tab__ripple"></span>
        </button>
      </div>
    </div>
  </div>
</div>
<!-- 	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">Navbar</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#home">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#mapPage">Havens</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#feedback_page">Feedback</a>
      </li>
    </ul>
  </div>
  </nav> -->
    
  <div class="content" id="home">
    <body class="homeBody">
       <img src="./logo.jpg" id="logo" align="middle" class="center"> <br><br><br>
        <div class="white-box">
            <body class="mdc-typography">
              <h1 class="mdc-typography--headline2">Mission</h1>
            
              <p class="mdc-typography--body1"> The purpose of the Chicago Safety App is to provide a platform for anyone
                who is living in Chicago, or visiting, to find a safe place. With the click of a button, a user can easily find any
                police station or health clinic near their location. These safe places are known as havens.</p><br>
              <h1 class="mdc-typography--headline2">My Story</h1>
            
              <p class="mdc-typography--body1"> As I grew older witnessed many of my friends and family fall victim to senseless acts of violence. 
                I know an app cannot easily fix this problem, but I do believe these violent acts can be prevented if people are around a safe area. There
                are also may women who are survivers of sexual assault that do not know what to do after their assault. The Chicago Safety App can show them 
                  where to start.</p>
                </body>
        </div>
        </body>
      
      
  </div>
  <div class="content" id="feedback_page">
    <body class ="screen2Body">
        <div class="white-box">
            <p class="mdc-typography--body1">Your feedback can help Chicago become a safer city. Please submit any questions, complaints, or reccomendations below.</p>
        </div>
       Name:<br>
        <div class="mdc-text-field">
          <input type="text" id="name" class="mdc-text-field__input">
          <label class="mdc-floating-label" for="my-text-field"></label>
          <div class="mdc-line-ripple"></div>
        </div><br>
        Email:<br>
        <div class="mdc-text-field">
          <input type="text" id="email" class="mdc-text-field__input">
          <label class="mdc-floating-label" for="my-text-field"></label>
          <div class="mdc-line-ripple"></div>
        </div><br>
        Feedback: <br>
        <div class="mdc-text-field mdc-text-field--textarea">
          <textarea id="feedback_text" class="mdc-text-field__input " rows="8" cols="40" style="background-color:white;"></textarea>
          <div class="mdc-notched-outline">
            <div class="mdc-notched-outline__leading"></div>
            <div class="mdc-notched-outline__notch">
                
              <label for="textarea" class="mdc-floating-label"></label>
            </div>
            <div class="mdc-notched-outline__trailing"></div>
          </div>
        </div>
        <br><button class="foo-button mdc-button mdc-button--raised" id="feedback_button">Submit</button>
      
    </body>
      <script>
         $("#feedback_button").on("click", function() {
              
              var db_name = $("#name").val();
              var db_email = $("#email").val();
              var db_feedback = $("#feedback_text").val();
              console.log(db_name);
              db.submission.put({name: db_name , email: db_email , feedback: db_feedback}).then (function(){
                  //
                  // Then when data is stored, read from it
                  //
                  return db.submission.get(db_name);
              }).then(function (submission) {
                  //
                  // Display the result
                  //
                  alert ("Thank you for the submission " + submission.name);
              }).catch(function(error) {
                 //
                 // Finally don't forget to catch any error
                 // that could have happened anywhere in the
                 // code blocks above.
                 //
                 alert ("Ooops: " + error);
              });
          });  
      </script>
  </div>
  <div class="content" id="map_page">
     <body>
          <div class="mdc-select">
              <i class="mdc-select__dropdown-icon"></i>
              <select class="mdc-select__native-control" id="selection">
                <option value="stations" selected>Police Stations</option>
              <option value="hospitals" >Hospitals and Clinics</option>
              </select>
<!--   <label class="mdc-floating-label">Pick a Food Group</label> -->
              <div class="mdc-line-ripple"></div>
            </div>
        <button class="foo-button mdc-button mdc-button--raised" id="find">Look Up</button>
        <script>mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));</script>
<!--       <select id="selection">
              <option value="stations" selected>Police Stations</option>
              <option value="hospitals" >Hospitals and Clinics</option>
          </select> -->
<!--       <button id="find">Look Up</button></body>  -->
      <div id="map">
          
      
      <script>
          var pos;   //Global Variable for user position
          var police_endpoint = "https://data.cityofchicago.org/resource/9rg7-mz9y.json";
        var hospital_endpoint = "https://data.cityofchicago.org/resource/kcki-hnch.json";
          $("#find").on("click", function() {
              deleteMarkers();
              var choice = document.getElementById("selection").value;
              console.log(choice);
              if(choice=="stations"){
                  var endpoint = police_endpoint;
              }else{
                  var endpoint = hospital_endpoint;
              }
            $.get(endpoint, function(response) {
            console.log("in data callback");
            var data = response;
            createMarkers(map, data );
            map.setCenter(pos);
          });
          });
      var map, infoWindow, user;
      var markers = [];
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 41.8781, lng: -87.6298},
          zoom: 11
        });
          infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var userIcon = new google.maps.MarkerImage(
            "./user_icon.png",
            null, /* size is determined at runtime */
            null, /* origin is 0,0 */
            null, /* anchor is bottom center of the scaled image */
            new google.maps.Size(50, 50)
        );  
            var marker = new google.maps.Marker({
                position: pos,
                map: map,
                title: 'Hello World!',
                icon: userIcon

              });
              var infowindow = new google.maps.InfoWindow({
                  content: "You are here."
              });
              infowindow.open(map, marker);
              
//             infoWindow.setPosition(pos);
//             infoWindow.setContent('Location found.');
//             infoWindow.open(map);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
      
        

        
      

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          console.log("location error");
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
          

      }
        
        function createMarkers (map, data) {
        var choice = document.getElementById("selection").value;
        console.log(data);
        $.each(data, function(i,v) {
        if(choice == "stations"){
          var pinIcon = new google.maps.MarkerImage(
            "./policeIcon.png",
            null, /* size is determined at runtime */
            null, /* origin is 0,0 */
            null, /* anchor is bottom center of the scaled image */
            new google.maps.Size(50, 50)
        );  
        }
        if(choice == "hospitals"){
            var pinIcon = new google.maps.MarkerImage(
            "./hospitalIcon.png",
            null, /* size is determined at runtime */
            null, /* origin is 0,0 */
            null, /* anchor is bottom center of the scaled image */
            new google.maps.Size(50, 50)
        )}
          var location = {lat: parseFloat(v.latitude), lng: parseFloat(v.longitude) }
          var marker = new google.maps.Marker({position: location, map: map, icon: pinIcon
        });

          markers.push(marker);
         if(choice=="stations"){
          var infowindow = new google.maps.InfoWindow({
                content: "Address: " + v.address
          });
         }else{
            var infowindow = new google.maps.InfoWindow({
                content: "Address: " + v.street_address
          }); 
         }
          marker.addListener('click', function() {
            infowindow.open(map, marker);
          });

        });

  }
      function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(map);
        }
      }
      function clearMarkers() {
        setMapOnAll(null);
      }
      function deleteMarkers() {
        clearMarkers();
        markers = [];
      }
       </script>
<!--       <button class="btn btn-default" id="askButton">Ask for location</button>

      <div id="target"></div>      
      <script>
      var map;
      //Global map variable
      var markers = [];
      function initMap() {
      // The location of Chicago
      var chicago = {lat: 41.8781, lng: -87.6298};
      // The map, centered at Chicago

      map = new google.maps.Map(
          document.getElementById('map'), {zoom: 11, center: chicago});

                }
            </script> -->
  </div>
      </body> 
</div>
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
      

    <script>
      $(document).ready(function() {

        function hideScreens() {
          $(".content").hide();
        }

        $(".mdc-tab").on("click", function(){
          hideScreens();
          var target = $(this).attr("href");
          $(target).show();
        });

      });
    </script>
    
  <script src="https://apis.google.com/js/platform.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
   <script src="./script.js"></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBwK_K1oOiOHQ6Q_nWURmCC4-qh-3iJtA&callback=initMap">
    </script>
      
  </body>
</html>