<!DOCTYPE html>
<html>

<head>
    
<!--     <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> -->
    <link rel='manifest' href='./manifest.json'>
    <link href="https://unpkg.com/material-components-web@1.1.1/dist/material-components-web.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
    <meta name="google-signin-client_id" content="455879692718-31a814ua0ch6tal2errkrtf4976ckq1h.apps.googleusercontent.com">
	<title>3 screen app</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
	 crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="style.css">

	<style>
		.content {
			display: none;
			margin: 1em;
		}
	</style>
    

</head>

<body>
    


    <script src="https://unpkg.com/material-components-web@1.1.1/dist/material-components-web.min.js"></script>
    <script src="script.js"></script>
    <script>
        // register the service worker for offline use
        if('serviceWorker' in navigator) {
          navigator.serviceWorker
                   .register('./sw.js')
                   .then(function() { console.log("Service Worker Registered"); });
        }
    </script>
   
<!-- <aside class="mdc-drawer mdc-drawer--dismissible">
    <div class="mdc-drawer__content">
      <nav class="mdc-list">
        <a class="mdc-list-item mdc-list-item--activated" href="#" aria-current="page">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">inbox</i>
          <span class="mdc-list-item__text">Inbox</span>
        </a>
        <a class="mdc-list-item" href="#">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">send</i>
          <span class="mdc-list-item__text">Outgoing</span>
        </a>
        <a class="mdc-list-item" href="#">
          <i class="material-icons mdc-list-item__graphic" aria-hidden="true">drafts</i>
          <span class="mdc-list-item__text">Drafts</span>
        </a>
      </nav>
    </div>
  </aside>
  <div class="mdc-drawer-app-content">
    App Content
  </div> -->
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="#">Navbar</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#home">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#screen2">Screen 2</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#mapPage">Screen 3</a>
      </li>
    </ul>
  </div>
  </nav>
    
  <div class="content" id="home">
    <body class="homeBody">
       <img src="./logo.jpg" id="logo" align="middle" class="center"> <br><br><br>
        <div class="white-box">
            <body class="mdc-typography">
              <h1 class="mdc-typography--headline2">Mission</h1>
            
              <p class="mdc-typography--body1"> The purpose of the Chicago Safety App...</p><br>
              <h1 class="mdc-typography--headline2">My Story</h1>
            
              <p class="mdc-typography--body1"> The purpose of the Chicago Safety App...</p>
                </body>
        </div>
        </body>
      
      
  </div>
  <div class="content" id="screen2">
    <body class ="screen2Body">
        This is screen 2
      
    </body>
      <script>
          //
          // Define your database
          //
          var db = new Dexie("friend_database");
          db.version(1).stores({
              friends: 'name,shoeSize'
          });

          //
          // Put some data into it
          //
          db.friends.put({name: "Nicolas", shoeSize: 6}).then (function(){
              //
              // Then when data is stored, read from it
              //
              return db.friends.get('Nicolas');
          }).then(function (friend) {
              //
              // Display the result
              //
              alert ("Nicolas has shoe size " + friend.shoeSize);
          }).catch(function(error) {
             //
             // Finally don't forget to catch any error
             // that could have happened anywhere in the
             // code blocks above.
             //
             alert ("Ooops: " + error);
          });
      </script>
  </div>
  <div class="content" id="mapPage">
     <body>
          <div class="mdc-select">
              <i class="mdc-select__dropdown-icon"></i>
              <select class="mdc-select__native-control" id="selection">
                <option value="stations" selected>Police Stations</option>
              <option value="hospitals" >Hospitals and Clinics</option>
              </select>
<!--   <label class="mdc-floating-label">Pick a Food Group</label> -->
              <div class="mdc-line-ripple"></div>
            </div>
        <button class="foo-button mdc-button mdc-button--raised" id="find">Look Up</button>
        <script>mdc.ripple.MDCRipple.attachTo(document.querySelector('.foo-button'));</script>
<!--       <select id="selection">
              <option value="stations" selected>Police Stations</option>
              <option value="hospitals" >Hospitals and Clinics</option>
          </select> -->
<!--       <button id="find">Look Up</button></body>  -->
      <div id="map">
          
      
      <script>
          var pos;   //Global Variable for user position
          var police_endpoint = "https://data.cityofchicago.org/resource/9rg7-mz9y.json";
        var hospital_endpoint = "https://data.cityofchicago.org/resource/kcki-hnch.json";
          $("#find").on("click", function() {
              deleteMarkers();
              var choice = document.getElementById("selection").value;
              console.log(choice);
              if(choice=="stations"){
                  var endpoint = police_endpoint;
              }else{
                  var endpoint = hospital_endpoint;
              }
            $.get(endpoint, function(response) {
            console.log("in data callback");
            var data = response;
            createMarkers(map, data );
            map.setCenter(pos);
          });
          });
      var map, infoWindow, user;
      var markers = [];
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 41.8781, lng: -87.6298},
          zoom: 11
        });
          infoWindow = new google.maps.InfoWindow;

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var userIcon = new google.maps.MarkerImage(
            "./user_icon.png",
            null, /* size is determined at runtime */
            null, /* origin is 0,0 */
            null, /* anchor is bottom center of the scaled image */
            new google.maps.Size(50, 50)
        );  
            var marker = new google.maps.Marker({
                position: pos,
                map: map,
                title: 'Hello World!',
                icon: userIcon

              });
              var infowindow = new google.maps.InfoWindow({
                  content: "You are here."
              });
              infowindow.open(map, marker);
              
//             infoWindow.setPosition(pos);
//             infoWindow.setContent('Location found.');
//             infoWindow.open(map);
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
      
        

        
      

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
          console.log("location error");
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
          

      }
        
        function createMarkers (map, data) {
        var choice = document.getElementById("selection").value;
        console.log(data);
        $.each(data, function(i,v) {
        if(choice == "stations"){
          var pinIcon = new google.maps.MarkerImage(
            "./policeIcon.png",
            null, /* size is determined at runtime */
            null, /* origin is 0,0 */
            null, /* anchor is bottom center of the scaled image */
            new google.maps.Size(50, 50)
        );  
        }
        if(choice == "hospitals"){
            var pinIcon = new google.maps.MarkerImage(
            "./hospitalIcon.png",
            null, /* size is determined at runtime */
            null, /* origin is 0,0 */
            null, /* anchor is bottom center of the scaled image */
            new google.maps.Size(50, 50)
        )}
          var location = {lat: parseFloat(v.latitude), lng: parseFloat(v.longitude) }
          var marker = new google.maps.Marker({position: location, map: map, icon: pinIcon
        });

          markers.push(marker);
         if(choice=="stations"){
          var infowindow = new google.maps.InfoWindow({
                content: "Address: " + v.address
          });
         }else{
            var infowindow = new google.maps.InfoWindow({
                content: "Address: " + v.street_address
          }); 
         }
          marker.addListener('click', function() {
            infowindow.open(map, marker);
          });

        });

  }
      function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(map);
        }
      }
      function clearMarkers() {
        setMapOnAll(null);
      }
      function deleteMarkers() {
        clearMarkers();
        markers = [];
      }
       </script>
<!--       <button class="btn btn-default" id="askButton">Ask for location</button>

      <div id="target"></div>      
      <script>
      var map;
      //Global map variable
      var markers = [];
      function initMap() {
      // The location of Chicago
      var chicago = {lat: 41.8781, lng: -87.6298};
      // The map, centered at Chicago

      map = new google.maps.Map(
          document.getElementById('map'), {zoom: 11, center: chicago});

                }
            </script> -->
  </div>
      </body> 
</div>
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
      

    <script>
      $(document).ready(function() {

        function hideScreens() {
          $(".content").hide();
        }

        $(".nav-link").on("click", function(){
          hideScreens();
          var target = $(this).attr("href");
          $(target).show();
        });

      });
    </script>
    
  <script src="https://apis.google.com/js/platform.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
   <script src="./script.js"></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBwK_K1oOiOHQ6Q_nWURmCC4-qh-3iJtA&callback=initMap">
    </script>
      
  </body>
</html>